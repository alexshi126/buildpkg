# 
# @File:   SConscript 
# @Author: buildpkg.py 
# @Date:   [template_datetime]
#
# @LICENSE: https://github.com/rtpkgs/buildpkg/blob/master/LICENSE(GPLv3).
#
# Change Logs:
# Date           Author       Notes
# [template_date]     buildpkg.py  Generate the scons script automatically.

import os
from building import * 

# get current dir path
cwd = GetCurrentDir()

# init src and inc vars
src = []
inc = []

name    = [template_name]
version = [template_version]

# print debug info
# print(name + '-' + version)
# print('PKG_USING_' + name.upper()) 

# add to project 
def make_pkg(f):
    fs = os.listdir(f)
    for f1 in fs:
        tmp_path = os.path.join(f, f1)

        if os.path.isdir(tmp_path):
            make_pkg(tmp_path)

        else: 
            if os.path.splitext(tmp_path)[1] == '.c':
                src.append(tmp_path)
            elif os.path.splitext(tmp_path)[1] == '.h':
                inc.append(f)
            
make_pkg(cwd) 

# add group to IDE project
objs = DefineGroup(name + '-' + version, src, depend = ['PKG_USING_' + name.upper()], CPPPATH = inc)

# traversal subscript
list = os.listdir(cwd)
if GetDepend('PKG_USING_' + name.upper()):
    for d in list:
        path = os.path.join(cwd, d)
        if os.path.isfile(os.path.join(path, 'SConscript')):
            objs = objs + SConscript(os.path.join(d, 'SConscript'))

Return('objs') 